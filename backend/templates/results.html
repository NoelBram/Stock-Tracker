{% extends "base.html" %}

{% block content %}
<table>
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Returns</th>
    </tr>
  </thead>
  <tbody>
    {% for row in stocks %}
      {% set sanitized_symbol = row["Symbol"]|replace(' ', '')|replace('-', '')|replace('.', '') %}
      <tr class="symbol-link" data-bs-toggle="collapse" href="#{{ sanitized_symbol }}" role="button" aria-expanded="false" aria-controls="collapseExample">
          <td>{{ row["Symbol"] }}</td>
          <td>{{ row["Date"] }}</td>
          <td>{{ row["Open"] }}</td>
          <td>{{ row["High"] }}</td>
          <td>{{ row["Low"] }}</td>
          <td>{{ row["Close"] }}</td>
          <td>{{ row["Volume"] }}</td>
          <td>{{ row["Returns"] }}</td>
      </tr>
      <tr>
        <td colspan="8" class="card-output">
          <div class="collapse" id="{{ sanitized_symbol }}">
            <div class="card card-body">
              <canvas id="myChart" width="400" height="200"></canvas>
              <!-- Add other content here for each stock -->
            </div>
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
  // JavaScript code for creating the plot
  // Access the JSON data from the script tag
  var jsonData = JSON.parse(document.getElementById('jsonData').textContent).data;

  // Extract data from JSON object
  var xValues = jsonData.map(item => item.Date);
  var yValues = jsonData.map(item => item.Close);

  // Create a line chart using Chart.js
  var ctx = document.getElementById('myChart').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: xValues,
          datasets: [{
              label: 'Data from Python DataFrame',
              data: yValues,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });
</script>
{% endblock %}